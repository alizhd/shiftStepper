<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Shift Stepper: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li class="current"><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Shift Stepper Documentation</h1>  </div>
</div>
<div class="contents">
<h3 class="version">v0.02a </h3><h2><a class="anchor" id="intro"></a>
Introduction</h2>
<p>This library is written for the line of shift register controlled output boards produced by Logos Electromechanical, LLC. It is intended to be flexible enough to support all of the shift register interface boards current in production and planned for the future. Therefore, it has pieces that are not strictly necessary for those currently on the market.</p>
<p>The highest level object in this library is <a class="el" href="classshift_chain.html" title="Class to represent a daisy chain of boards.">shiftChain</a>, generally referred to as a chain. A chain is a set of one or more shift register boards. The farthest from the host (along the daisy chain cable) is board 0 and the one closest to the host has the highest index. This little endian structure mirrors the operation of the shift register chain, i.e. the first bit shifted ends up the farthest from the host at the end of the shifting operation. Each board, represented by a <a class="el" href="classshift_board.html" title="Abstract base class for individual boards with shiftDevice.">shiftBoard</a> object, contains one or more devices, each represented by a <a class="el" href="classshift_device.html" title="Abstract base class for creating devices such as motors that attach to a board.">shiftDevice</a> object. A device is a group of one or more channels that operate togeter -- for example, the four switches that drive a unipolar stepper motor. The only device types currently implemented are the <a class="el" href="classshift_step_motor.html" title="Implementation of a 4-phase unipolar stepper motor device.">shiftStepMotor</a> and <a class="el" href="classshift_switch_block.html" title="A block of plain switches.">shiftSwitchBlock</a>.</p>
<p>A channel is the smallest logical element on the board. On all of the shift register boards so far, a channel is a single switch controlled by a single bit. Future boards may have channels that involve many more bits; hence the term should be taken as generic.</p>
<p>New data is shifted out to the chain by calling <a class="el" href="classshift_chain.html#ad6727d72887b7017f68ef6dc7948a7ed" title="Do a timer tick -- call this from an ISR.">shiftChain::doTick()</a>. This can be called from inside the loop() function, but for the best stepper performance, it should be called by a timer interrupt service routine. The <a class="el" href="classshift_chain.html" title="Class to represent a daisy chain of boards.">shiftChain</a> object has member functions for setting up the timer correctly, but the user must supply the interrupt service routine. Only Timer 2 is implemented so far; adding more is also on the TODO list.</p>
<p><a class="el" href="classshift_chain.html#ad6727d72887b7017f68ef6dc7948a7ed" title="Do a timer tick -- call this from an ISR.">shiftChain::doTick()</a> calls the <a class="el" href="classshift_board.html#a5a120f7aeb958c8e8fd0ec87eecc5798" title="Handle for per timer tick behavior of each board.">shiftBoard::doBoardTick()</a> for each board in the chain. In turn, each example of <a class="el" href="classshift_board.html#a5a120f7aeb958c8e8fd0ec87eecc5798" title="Handle for per timer tick behavior of each board.">shiftBoard::doBoardTick()</a> calls shiftDevice::doDeviceTick() for each device in that board. These function are defined as virtual functions in the <a class="el" href="classshift_board.html" title="Abstract base class for individual boards with shiftDevice.">shiftBoard</a> and <a class="el" href="classshift_device.html" title="Abstract base class for creating devices such as motors that attach to a board.">shiftDevice</a> classes; individual boards and devices are implemented subclasses of these two classes, respectively, and must implement <a class="el" href="classshift_board.html#a5a120f7aeb958c8e8fd0ec87eecc5798" title="Handle for per timer tick behavior of each board.">shiftBoard::doBoardTick()</a> and shiftDevice::doDeviceTick().</p>
<p>The aim of all of this is to allow each board and each applicaiton of that board to be separately defined in a way that still plays nice together in a (potentially) long chain of such device and allows the addition of new boards and applications without disrupting source code based on this version of the library.</p>
<h2><a class="anchor" id="install"></a>
Installation</h2>
<p>In order to install this library, copy this directory into the arduino libraries directory.</p>
<p>Then restart the Arduino IDE and it should appear in the Tools/Import Library pulldown and in the File/Examples pulldown.</p>
<h2><a class="anchor" id="using"></a>
Using the Library</h2>
<p>The first step is declaring the devices that make up each board, each board, and the chain, in that order. There are clever ways to do this, but the simplest and most fool-proof way to do it is to declare all the objects at global scope. Here's how I do it in the included examples:</p>
<div class="fragment"><pre class="fragment">  <span class="keyword">static</span> <span class="keyword">const</span> uint8_t stepSequence[4] = {0x2, 0x4, 0x1, 0x8}; 

  <span class="keyword">static</span> <span class="keyword">const</span> uint8_t motChans0[<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>] = {0,2,3,1}; 
  <span class="keyword">static</span> <span class="keyword">const</span> uint8_t motChans1[<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>] = {4,5,6,7}; 
  <span class="keyword">static</span> <span class="keyword">const</span> uint8_t motChans2[<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>] = {11,9,10,8}; 
  <span class="keyword">static</span> <span class="keyword">const</span> uint8_t motChans3[<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>] = {15,14,13,12}; 

  <a class="code" href="classshift_chain.html" title="Class to represent a daisy chain of boards.">shiftChain</a> *myChain = 0; 
  <a class="code" href="classshift_step_motor.html" title="Implementation of a 4-phase unipolar stepper motor device.">shiftStepMotor</a> motor0(<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>, stepSequence, motChans0); 
  <a class="code" href="classshift_step_motor.html" title="Implementation of a 4-phase unipolar stepper motor device.">shiftStepMotor</a> motor1(<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>, stepSequence, motChans1); 
  <a class="code" href="classshift_step_motor.html" title="Implementation of a 4-phase unipolar stepper motor device.">shiftStepMotor</a> motor2(<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>, stepSequence, motChans2); 
  <a class="code" href="classshift_step_motor.html" title="Implementation of a 4-phase unipolar stepper motor device.">shiftStepMotor</a> motor3(<a class="code" href="_shift_stepper_8h.html#a19e74e78535a1c218485566fcc76751e" title="Number of channels each stepper motor consumes.">__channelsPerMotor__</a>, stepSequence, motChans3); 
  <a class="code" href="classshift_device.html" title="Abstract base class for creating devices such as motors that attach to a board.">shiftDevice</a> *motors[4] = {&amp;motor0, &amp;motor1, &amp;motor2, &amp;motor3}; 
  <a class="code" href="classshift_sixteen.html" title="Implementation of shiftBoard for a sixteen channel high current Arduino shield.">shiftSixteen</a> board0(4, motors); <a class="code" href="classshift_board.html" title="Abstract base class for individual boards with shiftDevice.">shiftBoard</a> *boards[1] = {&amp;board0}; 
  <a class="code" href="classshift_chain.html" title="Class to represent a daisy chain of boards.">shiftChain</a> storeChain(1, boards, DATPIN, SCLPIN, LATPIN, MRPIN, INDPIN);
</pre></div><p>All of these declarations could alternately be made static in the setup() function, with the exception of the declaration of *myChain, which has to be global in order to be useful. There are no blank constructors defined for any of these objects, so they must be fully initialized at declaration; that drives the order of the declaration in the above snippet. The various arrays are declared as global variables here due to the lack of proper array literals in C++.</p>
<p>Once you've declared all the members of the chain, you define the interrupt routine as shown above, assign the myChain pointer to point at storeChain, and start the timer:</p>
<div class="fragment"><pre class="fragment">  myChain = &amp;storeChain; 
  myChain-&gt;<a class="code" href="classshift_chain.html#a563be48435fee78934e72ef67be030e1" title="Start the timer.">startTimer</a>(<a class="code" href="_shift_stepper_8h.html#a103bd7a2dfbff14ab2ff191f2fc170ea" title="Sets timer pre-scaler to 32.">__preScaler32__</a>, 0, 2);
</pre></div><p>After that, the interrupt will execute every time the selected timer interrupt trips. What it does depends on what each device has been commanded to do. See the subclasses of <a class="el" href="classshift_device.html" title="Abstract base class for creating devices such as motors that attach to a board.">shiftDevice</a> for documentation of the command functions. </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Dec 17 2010 20:31:09 for Shift Stepper by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
